<script>
    $('#nav_menu_admin_monit').addClass('active')
</script>
<%= javascript_include_tag "jquery.dataTables.min" %>

<div class="container-fluid main-container">

  <%= render(:partial => "/sidebar/admonit") %>
  <div class="main-content clearfix">
    <div class="breadcrumbs" id="breadcrumbs">
      <ul class="breadcrumb">
        <li>
          <i class="icon-home"></i>
          管理员

			<span class="divider">
				<i class="icon-angle-right"></i>
			</span>
        </li>
        <li class="active">主机监控</li>
      </ul>
      <!--.breadcrumb-->
    </div>
    <div id="content" class="page-content">
      <!-- content starts -->


      <div class="row-fluid sortable">
        <div class="box span12">
          <div class="page-header position-relative">
            <h1>
              监控管理
              <small>
                <i class="icon-double-angle-right"></i>
                <span>主机</span>
              </small>
            </h1>
          </div>


          <% if @machineinfos_json == nil %>
            can't get machine informations!!!
          <% else %>
            <% machineinfos = @machineinfos_json["guardians"]  %>
            <div class="table-responsive">
              <div class="table-responsive">
                <div class="dataTables_wrapper" role="grid">

                  <table class="table table-striped table-bordered bootstrap-datatable datatable table-hover" id="listlogs">
                    <thead>
                        <tr>
                          <th>主机ID</th>
                          <th>IP</th>
                          <th>启动时间</th>
                          <th>运行时间</th>
                          <th>loadavg</th>
                          <th>详情</th>

                        </tr>
                    </thead>
                    <tbody>
                      <% if machineinfos != nil%>
                      <% machineinfos.each do |machine| %>
                          <tr>
                            <td><%= machine["machineinfo"]["machine_id"] %></td>
                            <td><%= machine["ipaddr"] %></td>
                            <td><%= to_mdata(machine["starttime"]) %></td>
                            <td><%= to_mdata(machine["lastreporttime"]) %></td>
                            <td><%= machine["machineinfo"]["loadavg"] %></td>
                            <td>
                              <%= link_to raw("<i class='icon-zoom-in icon-white'></i><h style='color:#FFF'>查看</h>"), {:controller => "mointor", :action => "machinedetail", :id => machineinfos.index(machine) }, :class => "btn btn-success btn-small" %>
                            </td>
                          </tr>
                      <% end %>
                      <% else %>
                      didn't open guardian!! 
                      <% end %>
                  
                    </tbody>
                  </table>
                </div>
              </div>
              <!--/span-->

            </div>
            <!--/table response -->
          <% end %>

        </div>
        <!--/span-->

      </div>
      <!--/row-->


      <!-- content ends -->
    </div>
    <!--/#content.span10-->
  </div>
  <!--/fluid-row-->




</div><!--/.fluid-container-->

<script>
    $(function () {
        $('#listlogs').dataTable({
                    "bLengthChange":false,
                    "bProcessing":true,
                    "bInfo":false,
                    "sDom":'<"top"i>rt<"bottom"flp><"clear">',
                }
        );
    })
</script>
